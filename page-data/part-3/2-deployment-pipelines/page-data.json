{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-3/2-deployment-pipelines","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's set up a deployment pipeline from GitHub to a host machine. We will demonstrate this using your local machine, but the same steps can be used for Raspberry Pi or even a virtual machine in the cloud (such as one provided by "},{"type":"element","tagName":"a","properties":{"href":"https://www.hetzner.com/cloud","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Hetzner"}]},{"type":"text","value":")."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We will use GitHub Actions to build an image, push the image to Docker Hub, and then use a project called \"Watchtower\" automatically pull the image from there."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's work with the repository "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/docker-hy.github.io","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://github.com/docker-hy/docker-hy.github.io"}]},{"type":"text","value":" as it already has a Dockerfile and the GitHub Actions config for our convenience."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"First either fork the repository or clone it as your own."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's go over the GitHub Actions instructions. We will be using the official actions offered by "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"docker"}]},{"type":"text","value":", but we could've just installed docker and ran docker build. Most of the following is simply copied from the action "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/marketplace/actions/build-and-push-docker-images","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"usage instructions"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Release DevOps with Docker "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Name of the workflow"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# On a push to the branch named master"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"push"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"branches"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" master\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Job called build runs-on ubuntu-latest"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"jobs"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"build"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"runs-on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ubuntu"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"latest\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"steps"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Checkout to the repository (the actions don't actually need this since they use the repository context anyway)"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" actions/checkout@v2\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# We need to login so we can later push the image without issues."}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Login to DockerHub\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" docker/login"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"action@v1\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"username"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" secrets.DOCKERHUB_USERNAME "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"password"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" secrets.DOCKERHUB_TOKEN "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Builds devopsdockeruh/docker-hy.github.io"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Build and push\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" docker/build"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"push"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"action@v2\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"push"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean","important"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"tags"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" devopsdockeruh/coursepage"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"latest"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before this will work we will need to add 2 Secrets to the repository: "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"DOCKERHUB_TOKEN"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"DOCKERHUB_USERNAME"}]},{"type":"text","value":". This is done by opening the repository in browser and first pressing "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Settings"}]},{"type":"text","value":" then "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Secrets"}]},{"type":"text","value":". The "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"DOCKERHUB_TOKEN"}]},{"type":"text","value":" can be created in Docker Hub, click your username and then "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Account Settings"}]},{"type":"text","value":" and "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Security"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now create a docker-compose.yml. We will use "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/containrrr/watchtower","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"watchtower"}]},{"type":"text","value":" to automate the updates."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Watchtower is an open source project that automates the task of updating images. It will poll the source of the image (in this case dockerhub) for changes in the containers that are running. The container that is running will be updated when a new version of the image is pushed to docker hub. Watchtower respects tags e.g. container using ubuntu:18.04 will not be updated unless a new version of ubuntu:18.04 is released."}]},{"type":"element","tagName":"text-box","properties":{"name":"Security reminder: Docker Hub accessing your computer","variant":"hint"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that now anyone with access to your Docker Hub also has access to your PC through this. If they push a malicious update to your application watchtower will happily download and start the updated version."}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"version"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"3.8\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"services"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"coursematerial"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" devopsdockeruh/coursepage\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 4000"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"container_name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" coursematerial\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"watchtower"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" containrrr/watchtower\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"  WATCHTOWER_POLL_INTERVAL=60 "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Poll every 60 seconds"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" /var/run/docker.sock"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"/var/run/docker.sock\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"container_name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" watchtower"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before running docker-compose up here, beware that watchtower will try to update "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"every"}]},{"type":"text","value":" image running in case there is a new version. Check the "},{"type":"element","tagName":"a","properties":{"href":"https://containrrr.github.io/watchtower/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":" if you want to prevent this."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Run this with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose up"}]},{"type":"text","value":" and commit something new into the repository. When you do the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"git push"}]},{"type":"text","value":", follow how the github actions pushes a new image to DockerHub and then watchtower pulls the new image to your machine."}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 3.1: A deployment pipeline to Heroku"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's create our first deployment pipeline!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For this exercise you can select which ever web application you already have containerized."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you don't have any web applications available you can use any one from this course and modify it. (Such as the course material itself)"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Use GitHub, Github Actions, and Heroku to deploy a container to heroku. You can also use other CI/CD tools instead of GitHub Actions."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit a link to the repository with the config."}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 3.2: Building images inside of a container"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Watchtower uses volume to docker.sock socket to access Docker daemon of the host from the container. By leveraging this ourselves we can create our own simple build service."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Create a project that downloads a repository from github, builds a Dockerfile located in the root and then publishes it into Docker Hub."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can use any programming language / technology for the project implementation. A simple bash script is viable."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Then create a Dockerfile for it so that it can be run inside a container."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Make sure that it can build at least some of the example projects."}]}]}]},"html":"<div><p>Let's set up a deployment pipeline from GitHub to a host machine. We will demonstrate this using your local machine, but the same steps can be used for Raspberry Pi or even a virtual machine in the cloud (such as one provided by <a href=\"https://www.hetzner.com/cloud\" target=\"_blank\" rel=\"noopener noreferrer\">Hetzner</a>).</p><p>We will use GitHub Actions to build an image, push the image to Docker Hub, and then use a project called \"Watchtower\" automatically pull the image from there.</p><p>Let's work with the repository <a href=\"https://github.com/docker-hy/docker-hy.github.io\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/docker-hy/docker-hy.github.io</a> as it already has a Dockerfile and the GitHub Actions config for our convenience.</p><p>First either fork the repository or clone it as your own.</p><p>Let's go over the GitHub Actions instructions. We will be using the official actions offered by <a href=\"https://github.com/docker\" target=\"_blank\" rel=\"noopener noreferrer\">docker</a>, but we could've just installed docker and ran docker build. Most of the following is simply copied from the action <a href=\"https://github.com/marketplace/actions/build-and-push-docker-images\" target=\"_blank\" rel=\"noopener noreferrer\">usage instructions</a>:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Release DevOps with Docker <span class=\"token comment\"># Name of the workflow</span>\n\n<span class=\"token comment\"># On a push to the branch named master</span>\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n\n<span class=\"token comment\"># Job called build runs-on ubuntu-latest</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Checkout to the repository (the actions don't actually need this since they use the repository context anyway)</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n\n    <span class=\"token comment\"># We need to login so we can later push the image without issues.</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Login to DockerHub\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/login<span class=\"token punctuation\">-</span>action@v1\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token comment\"># Builds devopsdockeruh/docker-hy.github.io</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and push\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/build<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>action@v2\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> devopsdockeruh/coursepage<span class=\"token punctuation\">:</span>latest</code></pre></div><p>Before this will work we will need to add 2 Secrets to the repository: <code class=\"language-text\">DOCKERHUB_TOKEN</code> and <code class=\"language-text\">DOCKERHUB_USERNAME</code>. This is done by opening the repository in browser and first pressing <em>Settings</em> then <em>Secrets</em>. The <code class=\"language-text\">DOCKERHUB_TOKEN</code> can be created in Docker Hub, click your username and then <em>Account Settings</em> and <em>Security</em>.</p><p>Now create a docker-compose.yml. We will use <a href=\"https://github.com/containrrr/watchtower\" target=\"_blank\" rel=\"noopener noreferrer\">watchtower</a> to automate the updates.</p><p>Watchtower is an open source project that automates the task of updating images. It will poll the source of the image (in this case dockerhub) for changes in the containers that are running. The container that is running will be updated when a new version of the image is pushed to docker hub. Watchtower respects tags e.g. container using ubuntu:18.04 will not be updated unless a new version of ubuntu:18.04 is released.</p><text-box name=\"Security reminder: Docker Hub accessing your computer\" variant=\"hint\"><p>Note that now anyone with access to your Docker Hub also has access to your PC through this. If they push a malicious update to your application watchtower will happily download and start the updated version.</p></text-box><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">coursematerial</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> devopsdockeruh/coursepage\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> 4000<span class=\"token punctuation\">:</span><span class=\"token number\">80</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> coursematerial\n  <span class=\"token key atrule\">watchtower</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> containrrr/watchtower\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span>  WATCHTOWER_POLL_INTERVAL=60 <span class=\"token comment\"># Poll every 60 seconds</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/var/run/docker.sock\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> watchtower</code></pre></div><p>Before running docker-compose up here, beware that watchtower will try to update <strong>every</strong> image running in case there is a new version. Check the <a href=\"https://containrrr.github.io/watchtower/\" target=\"_blank\" rel=\"noopener noreferrer\">documentation</a> if you want to prevent this.</p><p>Run this with <code class=\"language-text\">docker-compose up</code> and commit something new into the repository. When you do the <code class=\"language-text\">git push</code>, follow how the github actions pushes a new image to DockerHub and then watchtower pulls the new image to your machine.</p><exercise name=\"Exercise 3.1: A deployment pipeline to Heroku\"><p>Let's create our first deployment pipeline!</p><p>For this exercise you can select which ever web application you already have containerized.</p><p>If you don't have any web applications available you can use any one from this course and modify it. (Such as the course material itself)</p><p>Use GitHub, Github Actions, and Heroku to deploy a container to heroku. You can also use other CI/CD tools instead of GitHub Actions.</p><p>Submit a link to the repository with the config.</p></exercise><exercise name=\"Exercise 3.2: Building images inside of a container\"><p>Watchtower uses volume to docker.sock socket to access Docker daemon of the host from the container. By leveraging this ourselves we can create our own simple build service.</p><p>Create a project that downloads a repository from github, builds a Dockerfile located in the root and then publishes it into Docker Hub.</p><p>You can use any programming language / technology for the project implementation. A simple bash script is viable.</p><p>Then create a Dockerfile for it so that it can be run inside a container.</p><p>Make sure that it can build at least some of the example projects.</p></exercise></div>","frontmatter":{"path":"/part-3/2-deployment-pipelines","title":"Deployment pipelines"},"fileAbsolutePath":"/home/runner/work/Docker-exercise/Docker-exercise/data/part-3/section-2.md"},"allPages":{"edges":[{"node":{"id":"b3a06a99-478d-55a4-9cc1-d69575b4d32c","frontmatter":{"path":"/faq","title":"Frequently asked questions"}}},{"node":{"id":"cfd0747d-914b-58fd-8123-8e0c442eb1b9","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"5bb47ad0-b8d2-5bd0-baec-e41c3bdb1c60","frontmatter":{"path":"/getting-started","title":"Getting started"}}},{"node":{"id":"55c9d384-35d1-572e-ad03-04e9875f2a76","frontmatter":{"path":"/","title":"About this course"}}},{"node":{"id":"10c6e50d-f6f5-5ae3-a5bb-9d744b586795","frontmatter":{"path":"/links","title":"Links"}}},{"node":{"id":"d9589b60-f836-5c76-b5f6-6bc5b2f2f0ed","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"07b7eaa5-1d05-5a26-ac0b-432a806f5e24","frontmatter":{"path":"/part-1/1-getting-started","title":"Definitions and basic concepts"}}},{"node":{"id":"9d74315f-66cb-5db4-901c-e72563df2cdf","frontmatter":{"path":"/part-1/2-running-and-stopping","title":"Running and stopping containers"}}},{"node":{"id":"7576df19-e29b-5b6a-af8f-8431bc65f832","frontmatter":{"path":"/part-1/6-docker-hub","title":"Utilizing tools from the Registry"}}},{"node":{"id":"d712af4c-747e-5d40-a2e8-2325d12e1ee5","frontmatter":{"path":"/part-1/7-summary","title":"Summary"}}},{"node":{"id":"68b09cfd-2ca0-5414-9991-5f758e4dd5e8","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"65b9c481-2fa6-593d-b40a-652a59522563","frontmatter":{"path":"/part-2/1-migrating-to-docker-compose","title":"Migrating to docker compose"}}},{"node":{"id":"2d2eac8b-a710-5ac5-98cd-3d8f2a3b810c","frontmatter":{"path":"/part-2/2-docker-networking","title":"Docker networking"}}},{"node":{"id":"4324afef-7181-5900-8206-c2bb4ca8451b","frontmatter":{"path":"/part-2/3-volumes-in-action","title":"Volumes in action"}}},{"node":{"id":"3fa82ecc-29ac-5591-9927-d0bda27d6dac","frontmatter":{"path":"/part-1/5-volumes-and-ports","title":"Interacting with the container via volumes and ports"}}},{"node":{"id":"37c403d4-4564-57c7-b225-a84bd5224895","frontmatter":{"path":"/part-2/5-summary","title":"Summary"}}},{"node":{"id":"e8a96446-1bc6-5d32-aee2-3707ae08e96d","frontmatter":{"path":"/part-2/4-containers-in-development","title":"Containers in development"}}},{"node":{"id":"4825e9ea-35de-51e0-b751-ee7eccb4429d","frontmatter":{"path":"/part-1/4-defining-start-conditions","title":"Defining start conditions for the container"}}},{"node":{"id":"1a7e7b06-e926-5ec3-b82f-bbfabcbb533f","frontmatter":{"path":"/part-1/3-in-depth-dive-to-images","title":"In-depth dive to images"}}},{"node":{"id":"08f1a4d0-8b8a-5a9b-857e-b327af16e4fd","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"f20c3af8-dfb9-5494-b517-a64a414139b2","frontmatter":{"path":"/part-3/1-deeper-understainding-of-containers","title":"Deeper understanding of containers"}}},{"node":{"id":"93a8d56d-2100-5286-bbcd-9a81d193ea56","frontmatter":{"path":"/part-3/2-deployment-pipelines","title":"Deployment pipelines"}}},{"node":{"id":"5d3c8fd1-0acd-5d77-8a9b-73da7f94aec7","frontmatter":{"path":"/part-3/3-using-non-root-user","title":"Using a non-root user"}}},{"node":{"id":"e0ffe555-3ff7-5e13-8a5f-11b939fe26e8","frontmatter":{"path":"/part-3/4-optimizing-the-image-size","title":"Optimizing the image size"}}},{"node":{"id":"b23dce26-34d9-5edb-a5d0-9d0304786686","frontmatter":{"path":"/part-3/5-multi-host-environments","title":"Multi-host environments"}}},{"node":{"id":"23a6c156-6839-532b-a69c-fc6c048d9ce3","frontmatter":{"path":"/part-3/6-end","title":"End"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}